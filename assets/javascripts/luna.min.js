(function(b,a){a.Luna={removePerson:function(c){b(c).parent().remove();return false},addBeneficiary:function(d,c){var f=b("<div>").html(c).text();var j=b("ul#luna-beneficiaries");if(j.children("li."+d).length==0){var e=b("<li>").addClass(d).html(f);var k=b("<select>").attr("name","users["+d+"]");var l=j.data("levels");for(var g=0;g<l.length;g++){var h=b("<option>").attr("value",l[g].value).html(l[g].name);k.append(h)}e.append(k);j.append(e)}},getFilterNames:function(){var d=b("#luna-newfilter");var c=b("#luna-newfilter-name");var e=b("#luna-newfilter-config");b.ajax({url:d.data("filternames-url"),dataType:"json",beforeSend:function(g,f){d.removeClass("hidden-js");c.html(b("<img>").attr("width",16).attr("height",16).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(g){d.addClass("newfilter");var f=b("<select>").attr("name","field").on("change",function(){b.ajax({url:b("#luna-newfilter").data("filterdata-url"),data:{field:b('select[name="field"] option:selected').val()},dataType:"json",beforeSend:function(j,i){e.html(b("<img>").attr("width",16).attr("height",16).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(l){var m=l.compare;var k=b("<select>").attr("name","compare");b.each(m,function(n,o){var p=b("<option>").attr("value",n).html(o);k.append(p)});var j=l.values;var i=b("<select>").attr("name","value");b.each(j,function(n,p){var o=b("<option>").attr("value",n).html(p);i.append(o)});e.html("");e.append(k);e.append(i);b('button[name="apply"]').removeClass("hidden-js")}})});var h=b("<option>").attr("value","").html("-- "+d.data("pleasechoose")+" --");f.append(h);b.each(g,function(i,k){var j=b("<option>").attr("value",i).html(k);f.append(j)});c.html(f)}})},removeFilter:function(d){b(d).parent().remove();var c=b("#luna-applied-filters");c.data("filter-count",c.data("filter-count")-1);if(c.children("span.luna-filter").length==0){c.addClass("hidden-js");b("section#luna-save-filters").addClass("hidden-js")}a.Luna.loadPersons()},loadFilterPreset:function(){var e=b("#luna-userfilter-preset");if(e.children("option:selected").attr("value")!=""){var c=e.data("update-url").split("?");var d=c[0]+"/"+e.children("option:selected").attr("value");if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,dataType:"html",beforeSend:function(g,f){b("div#luna-applied-filters").html(b("<img>").attr("width",32).attr("height",32).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(g){var f=b("div#luna-applied-filters");f.html(g);f.removeClass("hidden-js");a.Luna.loadPersons(0)}})}},loadPersons:function(e,g){var f=b("#luna-data");var c=b(f).data("update-url").split("?");var d=c[0]+"/"+e;if(g!=""&&g!=null){d+="/"+g}if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,data:b('input[type="hidden"][name*="filters["]').serialize(),dataType:"html",beforeSend:function(i,h){f.html(b("<img>").attr("width",64).attr("height",64).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(h){f.html(h)}});return false},addEmail:function(){var c=b("section#luna-email-template");var e=c.clone();var d=parseInt(c.data("number-of-emails"),10)+1;e.attr("id",null).attr("data-number-of-emails",null);e.find('input[name="email-template-address"]').attr("name","email["+d+"][address]");e.find('select[name="email-template-type"]').attr("name","email["+d+"][type]");e.find('input[name="email-template-default"]').attr("name","email-default").attr("value",d);e.insertBefore("a.luna-email-add");c.data("number-of-emails",d)},addPhonenumber:function(){var c=b("section#luna-phone-template");var e=c.clone();var d=c.data("number-of-phonenumbers")+1;e.attr("id",null).data("number-of-phonenumbers",null);e.find('input[name="phone-template-number"]').attr("name","phone["+d+"][number]");e.find('select[name="phone-template-type"]').attr("name","phone["+d+"][type]");e.find('input[name="phone-template-default"]').attr("name","phone-default").attr("value",d);e.insertBefore("a.luna-phone-add");c.data("number-of-phonenumbers",d)},addSkill:function(e){var h=b("div#luna-person-skills");if(h.children("div#luna-skill-"+e.replace(" ","-")).length==0){var d=b("<div>").addClass("luna-skill").attr("id","luna-skill-"+e.replace(" ","-")).html(e);var g=b("<input>").attr("type","hidden").attr("name","skills[]").attr("value",e);var c=b("<a>").attr("href","").addClass("luna-skill-remove").on("click",function(){a.Luna.removeEntry(this);return false});var f=b("<img>").attr("src",a.ASSETS_URL+"images/icons/blue/trash.svg").attr("width","16").attr("height","16").addClass("icon-role-clickable").addClass("icon-role-trash");c.append(f);d.append(g);d.append(c);h.append(d)}},addTag:function(d){if(b.trim(d)!=""){var h=b("div#luna-person-tags");if(h.length==0){h=b("div#luna-company-tags")}if(h.children("div#luna-tag-"+d.replace(" ","-")).length==0){var c=b("<div>").addClass("luna-tag").attr("id","luna-tag-"+d.replace(" ","-")).html(d);var g=b("<input>").attr("type","hidden").attr("name","tags[]").attr("value",d);var e=b("<a>").attr("href","").addClass("luna-tag-remove").on("click",function(){a.Luna.removeEntry(this);return false});var f=b("<img>").attr("src",a.ASSETS_URL+"images/icons/blue/trash.svg").attr("width","16").attr("height","16").addClass("icon-role-clickable").addClass("icon-role-trash");e.append(f);c.append(g);c.append(e);h.append(c)}}},removeEntry:function(c){b(c).parent().remove()},prepareFileUpload:function(f){var h=b("ul#luna-newdocs");for(var g=0;g<f.files.length;g++){var c=b("<li>");var j=b("<input>").attr("type","hidden").attr("name","newdocs[]").attr("value",f.files[g].name);var k=b(document.createTextNode(f.files[g].name));var d=b("<a>").on("click",function(i){b(this).parent().remove()});var e=b("<img>").attr("src",a.ASSETS_URL+"images/icons/blue/trash.svg").attr("width","16").attr("height","16").addClass("icon-role-clickable").addClass("icon-role-trash");h.append(c.append(j).append(k).append(d.append(e)))}},loadCompanies:function(e,g){var f=b("#luna-data");var c=b(f).data("update-url").split("?");var d=c[0]+"/"+e;if(g!=""&&g!=null){d+="/"+g}if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,data:b('input[type="hidden"][name*="filters["]').serialize(),dataType:"html",beforeSend:function(i,h){f.html(b("<img>").attr("width",64).attr("height",64).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(h){f.html(h)}});return false},loadLogEntries:function(e){var f=b("#luna-data");var c=b(f).data("update-url").split("?");var d=c[0]+"/"+e;if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,data:b('input[type="hidden"][name*="filters["]').serialize(),dataType:"html",beforeSend:function(h,g){f.html(b("<img>").attr("width",64).attr("height",64).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(g){f.html(g)}});return false},loadSkills:function(e){var f=b("#luna-data");var c=b(f).data("update-url").split("?");var d=c[0]+"/"+e;if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,dataType:"html",beforeSend:function(h,g){f.html(b("<img>").attr("width",64).attr("height",64).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(g){f.html(g)}});return false},loadTags:function(e){var f=b("#luna-data");var c=b(f).data("update-url").split("?");var d=c[0]+"/"+e;if(c[1]!=""){d+="?"+c[1]}b.ajax({url:d,dataType:"html",beforeSend:function(h,g){f.html(b("<img>").attr("width",64).attr("height",64).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(g){f.html(g)}});return false},setEntriesPerPage:function(g,e){var c=b(e).data("set-url").split("?");var d=c[0];if(c[1]!=""&&c[1]!=null){d+="?"+c[1]}var f=b(e).parent();var h=b(e).children("option:selected").attr("value");b.ajax({url:d,data:{count:h,type:g},dataType:"json",beforeSend:function(j,i){f.html(b("<img>").attr("width",16).attr("height",16).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(){switch(g){case"persons":a.Luna.loadPersons(0);break;case"companies":a.Luna.loadCompanies(0);break;case"log":a.Luna.loadLogEntries(0);break;case"skills":a.Luna.loadSkills(0);break;case"tags":a.Luna.loadTags(0);break}}});return false},removeCompanyMember:function(e){var f=b(e).parent();var c=f.data("remove-url").split("?");var d=c[0];if(c[1]!=""&&c[1]!=null){d+="?"+c[1]}b.ajax({url:d+"/"+b(e).data("company")+"/"+b(e).data("member"),beforeSend:function(h,g){f.html(b("<img>").attr("width",16).attr("height",16).attr("src",a.ASSETS_URL+"images/ajax-indicator-black.svg"))},success:function(){f.parent().remove()}});return false},init:function(){var h=b('input[name="searchtext"]');h.typing({stop:function(){if(h.data("type")=="persons"){a.Luna.loadPersons(0,h.val())}else{if(h.data("type")=="companies"){a.Luna.loadCompanies(0,h.val())}}},delay:500});b("#luna-add-filter").on("click",function(){a.Luna.getFilterNames();return false});b("#luna-userfilter-preset").on("change",function(){a.Luna.loadFilterPreset();return false});var g=b('input[name="status"]');g.autocomplete({source:g.data("available-status"),minLength:2});b("a.luna-email-add").on("click",function(){a.Luna.addEmail();return false});b("a.luna-phone-add").on("click",function(){a.Luna.addPhonenumber();return false});b("a.luna-skill-remove").on("click",function(){a.Luna.removeEntry(this);return false});var d=b('input[name="skill"]');b("a.luna-skill-add").on("click",function(){a.Luna.addSkill(d.val());d.val("");return false});d.autocomplete({source:d.data("available-skills"),minLength:2,select:function(i,j){a.Luna.addSkill(j.item.value);d.val("")}});d.on("keypress",function(j){var i=(j.keyCode?j.keyCode:j.which);if(i=="13"){j.preventDefault();a.Luna.addSkill(d.val());d.val("")}});b("a.luna-tag-remove").on("click",function(){a.Luna.removeEntry(this);return false});var e=b('input[name="tag"]');b("a.luna-tag-add").on("click",function(){a.Luna.addTag(e.val());e.val("");return false});e.autocomplete({source:e.data("available-tags"),minLength:2,select:function(i,j){a.Luna.addTag(j.item.value);e.val("")}});e.on("keypress",function(j){var i=(j.keyCode?j.keyCode:j.which);if(i=="13"){j.preventDefault();a.Luna.addTag(e.val());e.val("")}});b('input[name="docs[]"]').on("change",function(){a.Luna.prepareFileUpload(this)});b("a#luna-toggle-recipients").on("click",function(){b("#luna-recipients").toggle();b("#luna-show-recipients").toggle();b("#luna-hide-recipients").toggle();return false});var f=b("label#luna-markers");var c=b("#luna-add-marker");f.children("select").on("change",function(){var i=b(this).children("option:selected");b("#luna-marker-description").html(i.data("description"));if(i.attr("value")!=""){c.removeClass("hidden-js")}else{c.addClass("hidden-js")}});f.insertAfter("div.buttons");c.on("click",function(){f.parent().children("textarea").insertAtCaret(b("label#luna-markers select option:selected").attr("value"));return false});b("a.luna-member-remove").on("click",function(){a.Luna.removeCompanyMember(this);return false})}};b(document).ready(function(){a.Luna.init();b(document).on("dialog-update",function(){a.Luna.init()});var c=b("div#luna-data");if(c.length>0){switch(c.data("type")){case"persons":a.Luna.loadPersons(0);break;case"companies":a.Luna.loadCompanies(0);break;case"skills":a.Luna.loadSkills(0);break;case"tags":a.Luna.loadTags(0);break;case"log":a.Luna.loadLogEntries(0);break}}})}(jQuery,STUDIP));